(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7167],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return u},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(a),c=r,g=m["".concat(s,".").concat(c)]||m[c]||d[c]||i;return a?n.createElement(g,o(o({ref:t},u),{},{components:a})):n.createElement(g,o({ref:t},u))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8215:function(e,t,a){"use strict";var n=a(7294);t.Z=function(e){var t=e.children,a=e.hidden,r=e.className;return n.createElement("div",{role:"tabpanel",hidden:a,className:r},t)}},1395:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var n=a(7294),r=a(944),i=a(6010),o="tabItem_1uMI",l="tabItemActive_2DSg";var s=37,p=39;var u=function(e){var t=e.lazy,a=e.block,u=e.defaultValue,d=e.values,m=e.groupId,c=e.className,g=(0,r.Z)(),f=g.tabGroupChoices,k=g.setTabGroupChoices,h=(0,n.useState)(u),b=h[0],y=h[1],N=n.Children.toArray(e.children),v=[];if(null!=m){var w=f[m];null!=w&&w!==b&&d.some((function(e){return e.value===w}))&&y(w)}var C=function(e){var t=e.currentTarget,a=v.indexOf(t),n=d[a].value;y(n),null!=m&&(k(m,n),setTimeout((function(){var e,a,n,r,i,o,s,p;(e=t.getBoundingClientRect(),a=e.top,n=e.left,r=e.bottom,i=e.right,o=window,s=o.innerHeight,p=o.innerWidth,a>=0&&i<=p&&r<=s&&n>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},T=function(e){var t,a;switch(e.keyCode){case p:var n=v.indexOf(e.target)+1;a=v[n]||v[0];break;case s:var r=v.indexOf(e.target)-1;a=v[r]||v[v.length-1]}null==(t=a)||t.focus()};return n.createElement("div",{className:"tabs-container"},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},c)},d.map((function(e){var t=e.value,a=e.label;return n.createElement("li",{role:"tab",tabIndex:b===t?0:-1,"aria-selected":b===t,className:(0,i.Z)("tabs__item",o,{"tabs__item--active":b===t}),key:t,ref:function(e){return v.push(e)},onKeyDown:T,onFocus:C,onClick:C},a)}))),t?(0,n.cloneElement)(N.filter((function(e){return e.props.value===b}))[0],{className:"margin-vert--md"}):n.createElement("div",{className:"margin-vert--md"},N.map((function(e,t){return(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==b})}))))}},9443:function(e,t,a){"use strict";var n=(0,a(7294).createContext)(void 0);t.Z=n},944:function(e,t,a){"use strict";var n=a(7294),r=a(9443);t.Z=function(){var e=(0,n.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},4403:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return p},metadata:function(){return u},toc:function(){return d},default:function(){return c}});var n=a(2122),r=a(9756),i=(a(7294),a(3905)),o=a(1395),l=a(8215),s=["components"],p={title:"TypeORM",sidebar_label:"SQL Databases"},u={unversionedId:"databases/typeorm",id:"databases/typeorm",isDocsHomePage:!1,title:"TypeORM",description:"A simple model:",source:"@site/docs/databases/typeorm.md",sourceDirName:"databases",slug:"/databases/typeorm",permalink:"/docs/databases/typeorm",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/docs/databases/typeorm.md",version:"current",sidebar_label:"SQL Databases",frontMatter:{title:"TypeORM",sidebar_label:"SQL Databases"},sidebar:"someSidebar",previous:{title:"Conversions",permalink:"/docs/common/conversions"},next:{title:"Create Models & Queries",permalink:"/docs/databases/create-models-and-queries"}},d=[{value:"The ORM",id:"the-orm",children:[]},{value:"Supported Databases",id:"supported-databases",children:[]},{value:"Use with FoalTS",id:"use-with-foalts",children:[{value:"Initial Configuration",id:"initial-configuration",children:[]},{value:"Packages",id:"packages",children:[]}]},{value:"Database Configuration Examples",id:"database-configuration-examples",children:[{value:"MySQL / MariaDB",id:"mysql--mariadb",children:[]},{value:"PostgreSQL",id:"postgresql",children:[]}]},{value:"Configuration and Testing",id:"configuration-and-testing",children:[]}],m={toc:d};function c(e){var t=e.components,a=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"A simple model:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Column, Entity, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class User {\n\n    @PrimaryGeneratedColumn()\n    id: number;\n\n    @Column()\n    firstName: string;\n\n    @Column()\n    lastName: string;\n\n}\n")),(0,i.kt)("h2",{id:"the-orm"},"The ORM"),(0,i.kt)("p",null,"FoalTS uses ",(0,i.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"TypeORM")," as default ",(0,i.kt)("em",{parentName:"p"},"Object-Relational Mapping"),". This allows you to create classes to interact with your database tables (or collections). TypeORM is written in TypeScript and supports both ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Active_record_pattern"},"Active Record")," and ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Data_mapper_pattern"},"Data Mapper")," patterns."),(0,i.kt)("p",null,"Here is a non-exhaustive list of its features:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"migrations and automatic migrations generation"),(0,i.kt)("li",{parentName:"ul"},"uni-directional, bi-directional and self-referenced relations"),(0,i.kt)("li",{parentName:"ul"},"eager and lazy relations"),(0,i.kt)("li",{parentName:"ul"},"TypeScript support"),(0,i.kt)("li",{parentName:"ul"},"connection configuration in json / xml / yml / env formats"),(0,i.kt)("li",{parentName:"ul"},"transactions"),(0,i.kt)("li",{parentName:"ul"},"etc")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Although this documentation presents the basic features of TypeORM, you may be interested in reading the ",(0,i.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"official documentation")," to learn more advanced features.")),(0,i.kt)("h2",{id:"supported-databases"},"Supported Databases"),(0,i.kt)("p",null,"FoalTS supports officially the following databases:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Database"),(0,i.kt)("th",{parentName:"tr",align:null},"Versions"),(0,i.kt)("th",{parentName:"tr",align:null},"Driver"),(0,i.kt)("th",{parentName:"tr",align:null}))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"PostgreSQL"),(0,i.kt)("td",{parentName:"tr",align:null},"9.6+ (",(0,i.kt)("a",{parentName:"td",href:"https://www.postgresql.org/support/versioning/"},"Version Policy"),")"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"pg@8")),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MySQL"),(0,i.kt)("td",{parentName:"tr",align:null},"5.7+ (",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/MySQL#Release_history"},"Version Policy"),")"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mysql@2")),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MariaDB"),(0,i.kt)("td",{parentName:"tr",align:null},"10.2+ (",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/MariaDB#Versioning"},"Version Policy"),")"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mysql@2")),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SQLite"),(0,i.kt)("td",{parentName:"tr",align:null},"3"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"sqlite3@5")," and ",(0,i.kt)("inlineCode",{parentName:"td"},"better-sqlite3@7")," (since v2.1)"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MongoDB"),(0,i.kt)("td",{parentName:"tr",align:null},"4.0+ (",(0,i.kt)("a",{parentName:"td",href:"https://www.mongodb.com/support-policy"},"Version Policy"),")"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mongodb@3")),(0,i.kt)("td",{parentName:"tr",align:null})))),(0,i.kt)("h2",{id:"use-with-foalts"},"Use with FoalTS"),(0,i.kt)("p",null,"TypeORM is integrated by default in each new FoalTS project. This allows you to quickly create models, run migrations and use the authentication system without wasting time on configuration. However, if you do not wish to use it, you can refer to the page ",(0,i.kt)("a",{parentName:"p",href:"/docs/databases/using-another-orm"},"Using another ORM"),"."),(0,i.kt)("h3",{id:"initial-configuration"},"Initial Configuration"),(0,i.kt)("p",null,"When creating a new project, an ",(0,i.kt)("inlineCode",{parentName:"p"},"SQLite")," database is used by default as it does not require any additional installation (the data is saved in a file). The connection configuration is stored in ",(0,i.kt)("inlineCode",{parentName:"p"},"ormconfig.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"default.json")," located respectively at the root of your project and in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/")," directory."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"ormconfig.js")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { Config } = require('@foal/core');\n\nmodule.exports = {\n  type: 'better-sqlite3',\n  database: Config.get('database.database', 'string'),\n  dropSchema: Config.get('database.dropSchema', 'boolean', false),\n  entities: ['build/app/**/*.entity.js'],\n  migrations: ['build/migrations/*.js'],\n  cli: {\n    migrationsDir: 'src/migrations'\n  },\n  synchronize: Config.get('database.synchronize', 'boolean', false)\n}\n")),(0,i.kt)(o.Z,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"yaml",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"database:\n  database: ./db.sqlite3\n"))),(0,i.kt)(l.Z,{value:"json",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "database": {\n    "database": "./db.sqlite3"\n  }\n}\n'))),(0,i.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'module.exports = {\n  database: {\n    database: "./db.sqlite3",\n  }\n}\n')))),(0,i.kt)("h3",{id:"packages"},"Packages"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"npm install typeorm @foal/typeorm\n")),(0,i.kt)("p",null,"Two packages are required to use TypeORM with FoalTS:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The package ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/typeorm"},"typeorm")," which is the official one of the ORM. It includes everything you need to create models and make database requests."),(0,i.kt)("li",{parentName:"ul"},"The package ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@foal/typeorm"},"@foal/typeorm")," (maintained by FoalTS) which contains additional components. These are particularly useful when using FoalTS ",(0,i.kt)("a",{parentName:"li",href:"/docs/authentication-and-access-control/quick-start"},"authentication and authorization system"),".")),(0,i.kt)("h2",{id:"database-configuration-examples"},"Database Configuration Examples"),(0,i.kt)("p",null,"This section shows how to configure ",(0,i.kt)("strong",{parentName:"p"},"MySQL")," or ",(0,i.kt)("strong",{parentName:"p"},"PostgreSQL")," with Foal."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"ormconfig.js")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { Config } = require('@foal/core');\n\nmodule.exports = {\n  type: 'mysql', // or 'postgres'\n\n  host: Config.get('database.host', 'string'),\n  port: Config.get('database.port', 'number'),\n  username: Config.get('database.username', 'string'),\n  password: Config.get('database.password', 'string'),\n  database: Config.get('database.database', 'string'),\n\n  dropSchema: Config.get('database.dropSchema', 'boolean', false),\n  synchronize: Config.get('database.synchronize', 'boolean', false),\n  \n  entities: [\"build/app/**/*.entity.js\"],\n  migrations: [\"build/migrations/*.js\"],\n  cli: {\n    migrationsDir: \"src/migrations\"\n  },\n}\n")),(0,i.kt)("p",null,"With this configuration, database credentials can be provided in a YAML, a JSON or a ",(0,i.kt)("inlineCode",{parentName:"p"},".env "),"configuration file or in environment variables."),(0,i.kt)(o.Z,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"yaml",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\n\ndatabase:\n  host: localhost\n  port: 3306\n  username: root\n  password: password\n  database: my-db\n"))),(0,i.kt)(l.Z,{value:"json",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // ...\n  "database": {\n    "host": "localhost",\n    "port": 3306,\n    "username": "root",\n    "password": "password",\n    "database": "my-db"\n  }\n}\n'))),(0,i.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'module.exports = {\n  // ...\n  database: {\n    host: "localhost",\n    port: 3306,\n    username: "root",\n    password: "password",\n    database: "my-db"\n  }\n}\n')))),(0,i.kt)("h3",{id:"mysql--mariadb"},"MySQL / MariaDB"),(0,i.kt)("p",null,"Install ",(0,i.kt)("inlineCode",{parentName:"p"},"mysql")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"mysql3")," drivers."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"npm install mysql --save # mysql2 is also supported\n")),(0,i.kt)("h3",{id:"postgresql"},"PostgreSQL"),(0,i.kt)("p",null,"Install ",(0,i.kt)("inlineCode",{parentName:"p"},"pg")," driver."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"npm install pg --save\n")),(0,i.kt)("h2",{id:"configuration-and-testing"},"Configuration and Testing"),(0,i.kt)("p",null,"When running the command ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run test")," with the above configuration, FoalTS will try to retrieve the database configuration in this order:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Environment variables."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},".env")," file."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"config/test.yml")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"config/test.json"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"config/default.yml")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"config/default.json"),".")),(0,i.kt)("p",null,"For example, if the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"DATABASE_PASSWORD")," is defined, Foal will use its value. Otherwise, it will look at the ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file to see if it is defined here. If it is not, it will go through the YAML and JSON ",(0,i.kt)("inlineCode",{parentName:"p"},"config/")," files."),(0,i.kt)("p",null,"In this way, you can define a default configuration in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/default.{yml|json}")," file to use both during development and testing and override some settings in ",(0,i.kt)("inlineCode",{parentName:"p"},"config/test.{yml|json}")," during testing."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"You learn more on how configuration works in Foal ",(0,i.kt)("a",{parentName:"p",href:"/docs/architecture/configuration"},"here"))),(0,i.kt)("p",null,"In the example below, we add two new options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"dropSchema")," clears the database each time we call ",(0,i.kt)("inlineCode",{parentName:"li"},"createConnection")),(0,i.kt)("li",{parentName:"ul"},"and ",(0,i.kt)("inlineCode",{parentName:"li"},"synchronize")," synchronizes the database tables with your entities so your do not have to generate and run migrations during testing.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"config/test.yml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\n\ndatabase:\n  username: 'test'\n  password: 'test'\n  database: 'test'\n  dropSchema: true\n  sychronize: true\n")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Example of a test")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createConnection, Connection } from 'typeorm';\n\ndescribe('xxx', () => {\n\n  let connection: Connection;\n\n  beforeEach(() => connection = await createConnection())\n\n  afterEach(async () => {\n    if (connection) {\n      await connection.close()\n    }\n  });\n\n  it('yyy', () => {\n    // ...\n  });\n\n});\n")))}c.isMDXComponent=!0},6010:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}a.d(t,{Z:function(){return r}})}}]);