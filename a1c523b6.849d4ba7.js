(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{205:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return b}));var r=n(3),o=n(7),a=(n(0),n(269)),i={title:"JWT hooks and CSRF protection"},c={unversionedId:"upgrade-to-v2/jwt-and-csrf",id:"upgrade-to-v2/jwt-and-csrf",isDocsHomePage:!1,title:"JWT hooks and CSRF protection",description:"Configuration",source:"@site/docs/upgrade-to-v2/jwt-and-csrf.md",slug:"/upgrade-to-v2/jwt-and-csrf",permalink:"/docs/upgrade-to-v2/jwt-and-csrf",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/docs/upgrade-to-v2/jwt-and-csrf.md",version:"current"},s=[{value:"Configuration",id:"configuration",children:[]},{value:"CSRF protection",id:"csrf-protection",children:[]},{value:"New features",id:"new-features",children:[{value:"JWT cookies",id:"jwt-cookies",children:[]},{value:"Read secrets and private/public keys",id:"read-secrets-and-privatepublic-keys",children:[]}]}],p={toc:s};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"configuration"},"Configuration"),Object(a.b)("p",null,"The configuration ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.secretOrPublicKey")," has been removed. Use ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.secret")," or ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.publicKey")," instead."),Object(a.b)("p",null,"The configuration ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.cookieName")," has been renamed to ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.cookie.name"),"."),Object(a.b)("p",null,"See also ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/upgrade-to-v2/config-system#environment-variables"}),"this"),"."),Object(a.b)("h2",{id:"csrf-protection"},"CSRF protection"),Object(a.b)("p",null,"The package ",Object(a.b)("inlineCode",{parentName:"p"},"@foal/csrf")," has been removed. In version 2, the CSRF protection is directly included in the JWT hooks and can be enabled with ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.csrf.enabled")," (the configuration key ",Object(a.b)("inlineCode",{parentName:"p"},"settings.csrf.enabled")," has been removed)."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm uninstall @foal/csrf\n")),Object(a.b)("p",null,"There is no need anymore to provide a CSRF secret."),Object(a.b)("p",null,"There is no need anymore to set manually the value of the ",Object(a.b)("inlineCode",{parentName:"p"},"sameSite")," cookie attribute in the config."),Object(a.b)("p",null,"There is no need anymore to specify an expire time for the CSRF cookie. "),Object(a.b)("p",null,"All of this is now managed by the framework."),Object(a.b)("p",null,"The best way to use the new CSRF protection is to go directly to the ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/security/csrf-protection"}),"CSRF page"),"."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Warning:")," Using the below functions ",Object(a.b)("inlineCode",{parentName:"p"},"setAuthCookie")," and ",Object(a.b)("inlineCode",{parentName:"p"},"removeAuthCookie")," is required in order to provide CSRF protection."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Warning:")," In order to ",Object(a.b)("em",{parentName:"p"},"work better")," with some popular frontend frameworks, the default name of the CSRF cookie has been changed from ",Object(a.b)("inlineCode",{parentName:"p"},"csrfToken")," to ",Object(a.b)("inlineCode",{parentName:"p"},"XSRF-TOKEN"),"."),Object(a.b)("h2",{id:"new-features"},"New features"),Object(a.b)("p",null,"New features have been added to reduce the amount of code needed to use JWT as well as to make it easier to use. You can consult the ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/authentication-and-access-control/quick-start"}),"Quick start page")," to see how to use these features."),Object(a.b)("h3",{id:"jwt-cookies"},"JWT cookies"),Object(a.b)("p",null,"The JWT package has two new functions ",Object(a.b)("inlineCode",{parentName:"p"},"setAuthCookie")," and ",Object(a.b)("inlineCode",{parentName:"p"},"removeAuthCookie")," to manage JWT with cookies."),Object(a.b)("h3",{id:"read-secrets-and-privatepublic-keys"},"Read secrets and private/public keys"),Object(a.b)("p",null,"Secrets and private/public keys can be read from the configuration with the two new functions ",Object(a.b)("inlineCode",{parentName:"p"},"getSecretOrPrivateKey")," and ",Object(a.b)("inlineCode",{parentName:"p"},"getSecretOrPublicKey"),". "),Object(a.b)("p",null,"Encoded secrets with the configuration key ",Object(a.b)("inlineCode",{parentName:"p"},"settings.jwt.secretEncoding")," are supported."))}b.isMDXComponent=!0},269:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return f}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=o.a.createContext({}),b=function(e){var t=o.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},l=function(e){var t=b(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),l=b(n),d=r,f=l["".concat(i,".").concat(d)]||l[d]||u[d]||a;return n?o.a.createElement(f,c(c({ref:t},p),{},{components:n})):o.a.createElement(f,c({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var p=2;p<a;p++)i[p]=n[p];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);