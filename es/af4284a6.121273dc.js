(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{216:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return s})),r.d(t,"metadata",(function(){return i})),r.d(t,"toc",(function(){return l})),r.d(t,"default",(function(){return p}));var a=r(3),n=r(7),o=(r(0),r(288)),s={title:"Los Scripts Shell"},i={unversionedId:"tutorials/real-world-example-with-react/4-the-shell-scripts",id:"tutorials/real-world-example-with-react/4-the-shell-scripts",isDocsHomePage:!1,title:"Los Scripts Shell",description:"Sus modelos est\xe1n listos para ser utilizados. Como en el tutorial anterior, utilizar\xe1 scripts shell para alimentar la base de datos.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/tutorials/real-world-example-with-react/4-the-shell-scripts.md",slug:"/tutorials/real-world-example-with-react/4-the-shell-scripts",permalink:"/es/docs/tutorials/real-world-example-with-react/4-the-shell-scripts",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/es/docusaurus-plugin-content-docs/current/tutorials/real-world-example-with-react/4-the-shell-scripts.md",version:"current",sidebar:"someSidebar",previous:{title:"Los Modelos User y Story",permalink:"/es/docs/tutorials/real-world-example-with-react/3-the-models"},next:{title:"Su Primera Ruta",permalink:"/es/docs/tutorials/real-world-example-with-react/5-our-first-route"}},l=[{value:"El script <code>create-user</code>",id:"el-script-create-user",children:[]},{value:"El script <code>create-story</code>",id:"el-script-create-story",children:[]}],c={toc:l};function p(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Sus modelos est\xe1n listos para ser utilizados. Como en el tutorial anterior, utilizar\xe1 scripts shell para alimentar la base de datos."),Object(o.b)("h2",{id:"el-script-create-user"},"El script ",Object(o.b)("inlineCode",{parentName:"h2"},"create-user")),Object(o.b)("p",null,"Ya existe un script llamado ",Object(o.b)("inlineCode",{parentName:"p"},"create-user")," en el directorio ",Object(o.b)("inlineCode",{parentName:"p"},"scripts"),"."),Object(o.b)("p",null,"Abra el archivo y sustituya su contenido por el siguiente:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// 3p\nimport { hashPassword } from '@foal/core';\nimport { createConnection, getConnection } from 'typeorm';\n\n// App\nimport { User } from '../app/entities';\n\nexport const schema = {\n  additionalProperties: false,\n  properties: {\n    email: { type: 'string', format: 'email', maxLength: 255 },\n    password: { type: 'string' },\n    name: { type: 'string', maxLength: 255 },\n  },\n  required: [ 'email', 'password' ],\n  type: 'object',\n};\n\nexport async function main(args: { email: string, password: string, name?: string }) {\n  const user = new User();\n  user.email = args.email;\n  user.password = await hashPassword(args.password);\n  user.name = args.name ?? 'Unknown';\n  user.avatar = '';\n\n  await createConnection();\n\n  try {\n    console.log(await user.save());\n  } catch (error) {\n    console.log(error.message);\n  } finally {\n    await getConnection().close();\n  }\n}\n\n")),Object(o.b)("p",null,"Algunas partes de este c\xf3digo deber\xedan resultarle familiares."),Object(o.b)("p",null,"El objeto ",Object(o.b)("inlineCode",{parentName:"p"},"schema")," se utiliza para validar los argumentos introducidos en la l\xednea de comandos. En este caso, el script espera dos par\xe1metros obligatorios ",Object(o.b)("inlineCode",{parentName:"p"},"email")," y ",Object(o.b)("inlineCode",{parentName:"p"},"password")," y un ",Object(o.b)("inlineCode",{parentName:"p"},"name")," opcional. La propiedad ",Object(o.b)("inlineCode",{parentName:"p"},"format")," comprueba que la cadena ",Object(o.b)("inlineCode",{parentName:"p"},"email")," es un correo electr\xf3nico (presencia del car\xe1cter ",Object(o.b)("inlineCode",{parentName:"p"},"@"),", etc). "),Object(o.b)("p",null,"La funci\xf3n ",Object(o.b)("inlineCode",{parentName:"p"},"main")," se llama despu\xe9s de la validaci\xf3n exitosa. Se divide en varias partes. Primero, crea un nuevo usuario con los argumentos especificados en la l\xednea de comandos. Luego establece una conexi\xf3n con la base de datos y guarda el usuario."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"La funci\xf3n ",Object(o.b)("inlineCode",{parentName:"p"},"hashPassword")," se utiliza para aplicar hash y sal a las contrase\xf1as antes de almacenarlas en la base de datos. Por razones de seguridad, debe utilizar esta funci\xf3n antes de guardar las contrase\xf1as.")),Object(o.b)("p",null,"Construya el script."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"npm run build\n")),Object(o.b)("p",null,"A continuaci\xf3n, cree dos nuevos usuarios."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'foal run create-user email="john@foalts.org" password="john_password" name="John"\nfoal run create-user email="mary@foalts.org" password="mary_password" name="Mary"\n')),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Si intenta volver a ejecutar uno de estos comandos, obtendr\xe1 el siguiente error de MySQL, ya que la clave de correo electr\xf3nico es \xfanica."),Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("inlineCode",{parentName:"p"},"ER_DUP_ENTRY: Duplicate entry 'john@foalts.org' for key 'IDX_xxx'"))),Object(o.b)("h2",{id:"el-script-create-story"},"El script ",Object(o.b)("inlineCode",{parentName:"h2"},"create-story")),Object(o.b)("p",null,"El script ",Object(o.b)("inlineCode",{parentName:"p"},"create-story")," es un poco m\xe1s complejo ya que ",Object(o.b)("inlineCode",{parentName:"p"},"Story")," tiene una relaci\xf3n de muchos a uno con ",Object(o.b)("inlineCode",{parentName:"p"},"User"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"foal generate script create-story\n")),Object(o.b)("p",null,"Abra el archivo ",Object(o.b)("inlineCode",{parentName:"p"},"create-story.ts")," y sustituya su contenido."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"import { createConnection } from 'typeorm';\nimport { Story, User } from '../app/entities';\n\nexport const schema = {\n  additionalProperties: false,\n  properties: {\n    author: { type: 'string', format: 'email', maxLength: 255 },\n    title: { type: 'string', maxLength: 255 },\n    link: { type: 'string', maxLength: 255 },\n  },\n  required: [ 'author', 'title', 'link' ],\n  type: 'object',\n};\n\nexport async function main(args: { author: string, title: string, link: string }) {\n  const connection = await createConnection();\n\n  const user = await User.findOneOrFail({ email: args.author });\n\n  const story = new Story();\n  story.author = user;\n  story.title = args.title;\n  story.link = args.link;\n\n  try {\n    console.log(await story.save());\n  } catch (error) {\n    console.error(error);\n  } finally {\n    await connection.close();\n  }\n}\n\n")),Object(o.b)("p",null,"Hemos a\xf1adido un par\xe1metro ",Object(o.b)("inlineCode",{parentName:"p"},"author")," para saber qu\xe9 usuario ha publicado el post. Se espera el correo electr\xf3nico del usuario."),Object(o.b)("p",null,"La funci\xf3n ",Object(o.b)("inlineCode",{parentName:"p"},"main")," intenta entonces encontrar al usuario que tiene este correo electr\xf3nico. Si existe, el usuario se a\xf1ade al post como autor. Si no lo hace, el script termina con un mensaje mostrado en la consola."),Object(o.b)("p",null,"Construya el script."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"npm run build\n")),Object(o.b)("p",null,"Y cree nuevas publicaciones para cada usuario."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'foal run create-story author="john@foalts.org" title="How to build a simple to-do list" link="https://foalts.org/docs/tutorials/simple-todo-list/1-installation"\nfoal run create-story author="mary@foalts.org" title="FoalTS architecture overview" link="https://foalts.org/docs/architecture/architecture-overview"\nfoal run create-story author="mary@foalts.org" title="Authentication with Foal" link="https://foalts.org/docs/authentication-and-access-control/quick-start"\n')))}p.isMDXComponent=!0},288:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return m}));var a=r(0),n=r.n(a);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=n.a.createContext({}),p=function(e){var t=n.a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=n.a.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),d=a,m=u["".concat(s,".").concat(d)]||u[d]||b[d]||o;return r?n.a.createElement(m,i(i({ref:t},c),{},{components:r})):n.a.createElement(m,i({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=r[c];return n.a.createElement.apply(null,s)}return n.a.createElement.apply(null,r)}d.displayName="MDXCreateElement"}}]);