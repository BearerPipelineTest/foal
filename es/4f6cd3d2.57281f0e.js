(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{139:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return l}));var o=n(3),r=n(7),a=(n(0),n(265)),s={title:"Tareas & Propriedad"},i={unversionedId:"tutorials/multi-user-todo-list/6-todos-and-ownership",id:"tutorials/multi-user-todo-list/6-todos-and-ownership",isDocsHomePage:!1,title:"Tareas & Propriedad",description:"Actualmente la API devuelve las tareas de cada usuario. Este no es el comportamiento esperado. Nos gustar\xeda que cada usuario tuviera acceso s\xf3lo a sus tareas.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/6-todos-and-ownership.md",slug:"/tutorials/multi-user-todo-list/6-todos-and-ownership",permalink:"/es/docs/tutorials/multi-user-todo-list/6-todos-and-ownership",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/es/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/6-todos-and-ownership.md",version:"current",sidebar:"someSidebar",previous:{title:"Controladores y Hooks de Autentificaci\xf3n",permalink:"/es/docs/tutorials/multi-user-todo-list/5-auth-controllers-and-hooks"},next:{title:"La P\xe1gina de Inscripci\xf3n",permalink:"/es/docs/tutorials/multi-user-todo-list/7-the-signup-page"}},c=[],u={toc:c};function l(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Actualmente la API devuelve las tareas de cada usuario. Este no es el comportamiento esperado. Nos gustar\xeda que cada usuario tuviera acceso s\xf3lo a sus tareas."),Object(a.b)("p",null,"Vuelva al ",Object(a.b)("inlineCode",{parentName:"p"},"ApiController")," y actualice la ruta ",Object(a.b)("inlineCode",{parentName:"p"},"getTodos"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"  @Get('/todos')\n  async getTodos(ctx: Context) {\n    const todos = await Todo.find({ owner: ctx.user });\n    return new HttpResponseOK(todos);\n  }\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"El objeto ",Object(a.b)("inlineCode",{parentName:"p"},"Contexto")," contiene cuatro propiedades:"),Object(a.b)("ul",{parentName:"blockquote"},Object(a.b)("li",{parentName:"ul"},"el objeto ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"https://expressjs.com/es/4x/api.html#req"}),"request")," de Express,"),Object(a.b)("li",{parentName:"ul"},"un objeto vac\xedo llamado ",Object(a.b)("inlineCode",{parentName:"li"},"state")," que puede utilizarse para compartir datos entre hooks, "),Object(a.b)("li",{parentName:"ul"},"un objeto ",Object(a.b)("inlineCode",{parentName:"li"},"session"),","),Object(a.b)("li",{parentName:"ul"},"y el objeto ",Object(a.b)("inlineCode",{parentName:"li"},"user")," que se define si un usuario se ha conectado."))),Object(a.b)("p",null,"Actualice la p\xe1gina de la lista de tareas. S\xf3lo deber\xeda ver las tareas del usuario con el que ha iniciado la sesi\xf3n."),Object(a.b)("p",null,"Sin embargo, si intenta crear una nueva tarea pendiente, \xe9sta desaparecer\xe1 al actualizar la p\xe1gina. Esto es perfectamente normal, ya que no se especifica su propietario en el momento de la creaci\xf3n."),Object(a.b)("p",null,"En cuanto a la funci\xf3n de borrado, tambi\xe9n hay que restringir su acceso. Los usuarios s\xf3lo deber\xedan poder borrar sus tareas."),Object(a.b)("p",null,"Actualice el controlador api."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"  @Post('/todos')\n  @ValidateBody({\n    additionalProperties: false,\n    properties: {\n      text: { type: 'string' }\n    },\n    required: [ 'text' ],\n    type: 'object',\n  })\n  async postTodo(ctx: Context) {\n    const todo = new Todo();\n    todo.text = ctx.request.body.text;\n    // Make the current user the owner of the todo.\n    todo.owner = ctx.user;\n\n    await todo.save();\n\n    return new HttpResponseCreated(todo);\n  }\n\n  @Delete('/todos/:id')\n  @ValidatePathParam('id', { type: 'number' })\n  async deleteTodo(ctx: Context) {\n    const todo = await Todo.findOne({\n      id: ctx.request.params.id,\n      // Do not return the todo if it does not belong to the current user.\n      owner: ctx.user\n    });\n    if (!todo) {\n      return new HttpResponseNotFound();\n    }\n    await todo.remove();\n    return new HttpResponseNoContent();\n  }\n")),Object(a.b)("p",null,"Ahora la aplicaci\xf3n funciona correctamente."))}l.isMDXComponent=!0},265:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),l=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=l(n),b=o,m=p["".concat(s,".").concat(b)]||p[b]||d[b]||a;return n?r.a.createElement(m,i(i({ref:t},u),{},{components:n})):r.a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=b;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var u=2;u<a;u++)s[u]=n[u];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);