(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{226:function(e,a,n){"use strict";n.r(a),n.d(a,"frontMatter",(function(){return o})),n.d(a,"metadata",(function(){return l})),n.d(a,"toc",(function(){return c})),n.d(a,"default",(function(){return u}));var t=n(3),r=n(7),i=(n(0),n(290)),o={title:"Autenticaci\xf3n en React"},l={unversionedId:"tutorials/real-world-example-with-react/10-auth-with-react",id:"tutorials/real-world-example-with-react/10-auth-with-react",isDocsHomePage:!1,title:"Autenticaci\xf3n en React",description:"La API del backend est\xe1 lista para ser utilizada. Ahora vamos a a\xf1adir la autenticaci\xf3n en el lado del frontend.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/tutorials/real-world-example-with-react/10-auth-with-react.md",slug:"/tutorials/real-world-example-with-react/10-auth-with-react",permalink:"/es/docs/tutorials/real-world-example-with-react/10-auth-with-react",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/es/docusaurus-plugin-content-docs/current/tutorials/real-world-example-with-react/10-auth-with-react.md",version:"current",sidebar:"someSidebar",previous:{title:"Autenticaci\xf3n en la API",permalink:"/es/docs/tutorials/real-world-example-with-react/9-authenticated-api"},next:{title:"A\xf1adida de la p\xe1gina de inscripci\xf3n",permalink:"/es/docs/tutorials/real-world-example-with-react/11-sign-up"}},c=[],s={toc:c};function u(e){var a=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(t.a)({},s,n,{components:a,mdxType:"MDXLayout"}),Object(i.b)("p",null,"La API del backend est\xe1 lista para ser utilizada. Ahora vamos a a\xf1adir la autenticaci\xf3n en el lado del frontend."),Object(i.b)("p",null,"As\xed es como se organiza la aplicaci\xf3n React:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Al hacer clic en el bot\xf3n ",Object(i.b)("em",{parentName:"li"},"Log in")," o ",Object(i.b)("em",{parentName:"li"},"Log out"),", la aplicaci\xf3n llama a las funciones definidas en ",Object(i.b)("inlineCode",{parentName:"li"},"requests/auth.ts")," para realizar consultas al servidor."),Object(i.b)("li",{parentName:"ul"},"La informaci\xf3n sobre el usuario actual se almacena en el componente ra\xedz ",Object(i.b)("inlineCode",{parentName:"li"},"App.tsx")," bajo el nombre ",Object(i.b)("inlineCode",{parentName:"li"},"currentUser"),". Si el usuario se ha conectado, este estado es de tipo ",Object(i.b)("inlineCode",{parentName:"li"},"{ id: number, name: string }"),". En caso contrario, su valor es ",Object(i.b)("inlineCode",{parentName:"li"},"null"),"."),Object(i.b)("li",{parentName:"ul"},"Al iniciar la sesi\xf3n, el servidor devuelve informaci\xf3n sobre el usuario que se utiliza para establecer el estado ",Object(i.b)("inlineCode",{parentName:"li"},"currentUser"),". Al cerrar la sesi\xf3n, la aplicaci\xf3n establece este estado como ",Object(i.b)("inlineCode",{parentName:"li"},"null"),".")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Saber, en el lado del cliente, si un usuario est\xe1 conectado y qui\xe9n es, es \xfatil para gestionar la visualizaci\xf3n de los elementos de la interfaz de usuario. Esto nos permite, por ejemplo, saber qu\xe9 botones de navegaci\xf3n deben ser visibles.")),Object(i.b)("p",null,"Abra el archivo ",Object(i.b)("inlineCode",{parentName:"p"},"requests/auth.ts")," e implemente las funciones vac\xedas."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-typescript"}),"import axios from 'axios';\nimport { ICredentials, IUser } from '../interfaces';\n\nexport async function logIn(credentials: ICredentials): Promise<IUser> {\n  const response = await axios.post<IUser>('/api/auth/login', credentials);\n  return response.data;\n}\n\nexport async function logOut(): Promise<void> {\n  await axios.post('/api/auth/logout');\n}\n\nexport async function signUp(credentials: ICredentials): Promise<IUser> {\n  const response = await axios.post<IUser>('/api/auth/signup', credentials);\n  return response.data;\n}\n\n")),Object(i.b)("p",null,"Vaya a ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"http://localhost:3000/login"}),"http://localhost:3000/login")," y con\xe9ctese. Deber\xeda ser redirigido a la p\xe1gina de inicio. Si hace clic en el bot\xf3n ",Object(i.b)("em",{parentName:"p"},"Profile")," de la barra de navegaci\xf3n, deber\xeda ser llevado a su p\xe1gina personal. Puede a\xf1adir o eliminar publicaciones si lo desea."),Object(i.b)("p",null,"Ahora vamos a actualizar la p\xe1gina. Se le redirige a la p\xe1gina de inicio de sesi\xf3n como si hubiera cerrado la sesi\xf3n. \xa1Ay!"),Object(i.b)("p",null,"La raz\xf3n de esto es que la aplicaci\xf3n del front-end ya no sabe que usted est\xe1 conectado. Si mira el componente ",Object(i.b)("inlineCode",{parentName:"p"},"App"),", ver\xe1 que el estado ",Object(i.b)("inlineCode",{parentName:"p"},"currentUser")," se inicializa a ",Object(i.b)("inlineCode",{parentName:"p"},"null")," cuando se carga la aplicaci\xf3n. As\xed que tenemos que encontrar una manera de mantener el estado de inicio de sesi\xf3n del usuario incluso si la p\xe1gina se actualiza."),Object(i.b)("p",null,"Para ello, utilizaremos una cookie adicional para almacenar esta informaci\xf3n que ser\xe1 legible por la aplicaci\xf3n front-end."),Object(i.b)("p",null,"Abra el archivo ",Object(i.b)("inlineCode",{parentName:"p"},"api.controller.ts")," y a\xf1ada la opci\xf3n ",Object(i.b)("inlineCode",{parentName:"p"},"userCookie"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-typescript"}),"import { Context } from '@foal/core';\n\n// ...\n\n@UseSessions({\n  cookie: true,\n  user: fetchUser(User),\n  userCookie: (ctx: Context<User|undefined>) => ctx.user ? JSON.stringify({ id: ctx.user.id, name: ctx.user.name }) : '',\n})\n")),Object(i.b)("p",null,"Esta opci\xf3n establece una cookie adicional ",Object(i.b)("inlineCode",{parentName:"p"},"user")," en el host del cliente con informaci\xf3n sobre el usuario actual."),Object(i.b)("p",null,"Ahora vuelva al archivo ",Object(i.b)("inlineCode",{parentName:"p"},"App.tsx")," y a\xf1ada la funci\xf3n ",Object(i.b)("inlineCode",{parentName:"p"},"getCurrentUserFromCookie")," que aparece a continuaci\xf3n."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-typescript"}),"import * as cookie from 'cookie';\n\nfunction getCurrentUserFromCookie(): IUser | null {\n  const userCookie = cookie.parse(document.cookie).user as string|undefined;\n  if (!userCookie) {\n    return null;\n  }\n  try {\n    return JSON.parse(userCookie);\n  } catch (error) {\n    return null;\n  }\n}\n\nexport default function App() {\n  const [currentUser, setCurrentUser] = useState(getCurrentUserFromCookie());\n\n  // ...\n\n}\n")),Object(i.b)("p",null,"Cuando la aplicaci\xf3n se carga, esta funci\xf3n comprobar\xe1 si existe una cookie ",Object(i.b)("inlineCode",{parentName:"p"},"user")," con informaci\xf3n sobre el usuario actual. Si es as\xed, su contenido se utilizar\xe1 para establecer el valor de ",Object(i.b)("inlineCode",{parentName:"p"},"currentUser"),"."),Object(i.b)("p",null,"Actualice la p\xe1gina. La aplicaci\xf3n ahora funciona como se esperaba."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Tambi\xe9n podr\xeda haber establecido una cookie del lado del cliente en la funci\xf3n ",Object(i.b)("inlineCode",{parentName:"p"},"logIn")," y eliminarla en la funci\xf3n ",Object(i.b)("inlineCode",{parentName:"p"},"logOut"),". Pero esta soluci\xf3n no funciona bien cuando el usuario se desconecta autom\xe1ticamente despu\xe9s de un per\xedodo de inactividad (expiraci\xf3n de la sesi\xf3n).")))}u.isMDXComponent=!0},290:function(e,a,n){"use strict";n.d(a,"a",(function(){return p})),n.d(a,"b",(function(){return m}));var t=n(0),r=n.n(t);function i(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){i(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function c(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),u=function(e){var a=r.a.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},p=function(e){var a=u(e.components);return r.a.createElement(s.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return r.a.createElement(r.a.Fragment,{},a)}},b=r.a.forwardRef((function(e,a){var n=e.components,t=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=u(n),b=t,m=p["".concat(o,".").concat(b)]||p[b]||d[b]||i;return n?r.a.createElement(m,l(l({ref:a},s),{},{components:n})):r.a.createElement(m,l({ref:a},s))}));function m(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var i=n.length,o=new Array(i);o[0]=b;var l={};for(var c in a)hasOwnProperty.call(a,c)&&(l[c]=a[c]);l.originalType=e,l.mdxType="string"==typeof e?e:t,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);