(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{119:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var r=n(3),o=n(7),a=(n(0),n(269)),s={title:"Los Scripts Shell"},i={unversionedId:"tutorials/multi-user-todo-list/3-the-shell-scripts",id:"tutorials/multi-user-todo-list/3-the-shell-scripts",isDocsHomePage:!1,title:"Los Scripts Shell",description:"Al igual que en el tutorial anterior, va a utilizar scripts shell para rellenar la base de datos.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/3-the-shell-scripts.md",slug:"/tutorials/multi-user-todo-list/3-the-shell-scripts",permalink:"/es/docs/tutorials/multi-user-todo-list/3-the-shell-scripts",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/es/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/3-the-shell-scripts.md",version:"current",sidebar:"someSidebar",previous:{title:"The Modelos User & Todo",permalink:"/es/docs/tutorials/multi-user-todo-list/2-the-user-and-todo-models"},next:{title:"Controladores y Hooks de Autentificaci\xf3n",permalink:"/es/docs/tutorials/multi-user-todo-list/5-auth-controllers-and-hooks"}},c=[{value:"El script <code>create-user</code>",id:"el-script-create-user",children:[]},{value:"El script <code>create-todo</code>",id:"el-script-create-todo",children:[]}],l={toc:c};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Al igual que en el tutorial anterior, va a utilizar scripts shell para rellenar la base de datos."),Object(a.b)("h2",{id:"el-script-create-user"},"El script ",Object(a.b)("inlineCode",{parentName:"h2"},"create-user")),Object(a.b)("p",null,"Ya existe un script llamado ",Object(a.b)("inlineCode",{parentName:"p"},"create-user")," en el directorio ",Object(a.b)("inlineCode",{parentName:"p"},"scripts/"),". Tiene un mont\xf3n de l\xedneas comentadas que le permiten crear usuarios con ",Object(a.b)("em",{parentName:"p"},"permisos")," y ",Object(a.b)("em",{parentName:"p"},"grupos"),"."),Object(a.b)("p",null,"Abra el archivo y sustituya su contenido por el siguiente:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"// 3p\nimport { isCommon } from '@foal/password';\nimport { createConnection } from 'typeorm';\n\n// App\nimport { User } from '../app/entities';\n\nexport const schema = {\n  additionalProperties: false,\n  properties: {\n    email: { type: 'string', format: 'email' },\n    password: { type: 'string' },\n  },\n  required: [ 'email', 'password' ],\n  type: 'object',\n};\n\nexport async function main(args: { email: string; password: string }) {\n  const connection = await createConnection();\n  try {\n    const user = new User();\n    user.email = args.email;\n\n    if (await isCommon(args.password)) {\n      console.log('This password is too common. Please choose another one.');\n      return;\n    }\n    await user.setPassword(args.password);\n\n    console.log(await user.save());\n  } catch (error) {\n    console.log(error.message);\n  } finally {\n    await connection.close();\n  }\n}\n\n")),Object(a.b)("p",null,"Algunas partes de este c\xf3digo deber\xedan resultarle familiares."),Object(a.b)("p",null,"El objeto ",Object(a.b)("inlineCode",{parentName:"p"},"schema")," se utiliza para validar los argumentos indicados en la l\xednea de comandos. En ese caso, el script define dos par\xe1metros obligatorios: un correo electr\xf3nico y una contrase\xf1a. La propiedad ",Object(a.b)("inlineCode",{parentName:"p"},"format")," comprueba que la cadena ",Object(a.b)("inlineCode",{parentName:"p"},"email")," es realmente un correo electr\xf3nico (presencia del car\xe1cter ",Object(a.b)("inlineCode",{parentName:"p"},"@"),", etc). "),Object(a.b)("p",null,"La funci\xf3n ",Object(a.b)("inlineCode",{parentName:"p"},"main")," se divide en varias partes. Primero instaura una conexi\xf3n con la base de datos. Luego, crea un nuevo usuario con los argumentos especificados en la l\xednea de comandos. La funci\xf3n ",Object(a.b)("inlineCode",{parentName:"p"},"isCommon")," compara la contrase\xf1a dada con una lista de diez mil contrase\xf1as comunes (ej: ",Object(a.b)("inlineCode",{parentName:"p"},"123456"),", ",Object(a.b)("inlineCode",{parentName:"p"},"password"),", etc). Devuelve ",Object(a.b)("inlineCode",{parentName:"p"},"true")," si se encuentra en la lista. Finalmente, el usuario se graba en la base de datos y, si se produce un error, se imprime el mensaje de error."),Object(a.b)("p",null,"Como habr\xe1 notado, la utilidad ",Object(a.b)("inlineCode",{parentName:"p"},"isCommon")," proviene del paquete ",Object(a.b)("inlineCode",{parentName:"p"},"@foal/password"),". Tiene que instalarla."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm install @foal/password\n")),Object(a.b)("p",null,"Ahora construya el script."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm run build\n")),Object(a.b)("p",null,"Cree dos nuevos usuarios."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'foal run create-user email="john@foalts.org" password="john_password"\nfoal run create-user email="mary@foalts.org" password="mary_password"\n')),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"Si intenta volver a ejecutar uno de estos comandos, obtendr\xe1 el siguiente error, ya que la clave de correo electr\xf3nico es \xfanica."),Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("inlineCode",{parentName:"p"},"SQLITE_CONSTRAINT: UNIQUE constraint failed: user.email"))),Object(a.b)("h2",{id:"el-script-create-todo"},"El script ",Object(a.b)("inlineCode",{parentName:"h2"},"create-todo")),Object(a.b)("p",null,"El script ",Object(a.b)("inlineCode",{parentName:"p"},"create-todo")," es un poco m\xe1s complejo ya que ",Object(a.b)("inlineCode",{parentName:"p"},"Todo")," tiene una relaci\xf3n many-to-one con ",Object(a.b)("inlineCode",{parentName:"p"},"User"),"."),Object(a.b)("p",null,"Abra el archivo ",Object(a.b)("inlineCode",{parentName:"p"},"create-todo.ts")," y sustituya su contenido."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"// 3p\nimport { createConnection } from 'typeorm';\n\n// App\nimport { Todo, User } from '../app/entities';\n\nexport const schema = {\n  properties: {\n    owner: { type: 'string', format: 'email' },\n    text: { type: 'string' },\n  },\n  required: [ 'owner', 'text' ],\n  type: 'object',\n};\n\nexport async function main(args: { owner: string; text: string }) {\n  const connection = await createConnection();\n  try {\n    const user = await User.findOne({ email: args.owner });\n\n    if (!user) {\n      console.log('No user was found with the email ' + args.owner);\n      return;\n    }\n\n    const todo = new Todo();\n    todo.text = args.text;\n    todo.owner = user;\n\n    console.log(await todo.save());\n  } catch (error) {\n    console.log(error.message);\n  } finally {\n    await connection.close();\n  }\n}\n\n")),Object(a.b)("p",null,"Hemos a\xf1adido un par\xe1metro ",Object(a.b)("inlineCode",{parentName:"p"},"propietario")," para saber a qu\xe9 usuario pertenece la tarea. Espera el correo electr\xf3nico del usuario."),Object(a.b)("p",null,"La funci\xf3n ",Object(a.b)("inlineCode",{parentName:"p"},"main")," intenta entonces obtener el usuario que tiene este correo electr\xf3nico. Si no existe, el script termina con un mensaje mostrado en la consola. Si no, el usuario se a\xf1ade a la tarea como su propietario."),Object(a.b)("p",null,"Construya el script."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm run build\n")),Object(a.b)("p",null,"Cree nuevas tareas para cada usuario."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'foal run create-todo owner="john@foalts.org" text="John task 1"\nfoal run create-todo owner="john@foalts.org" text="John task 2"\nfoal run create-todo owner="mary@foalts.org" text="Mary task 1"\nfoal run create-todo owner="mary@foalts.org" text="Mary task 2"\n')))}p.isMDXComponent=!0},269:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),p=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},b=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),b=r,m=u["".concat(s,".").concat(b)]||u[b]||d[b]||a;return n?o.a.createElement(m,i(i({ref:t},l),{},{components:n})):o.a.createElement(m,i({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=b;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var l=2;l<a;l++)s[l]=n[l];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);