(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{170:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return c}));var r=n(3),o=n(7),a=(n(0),n(259)),i={title:"Les Mod\xe8les User & Todo"},s={unversionedId:"tutorials/multi-user-todo-list/2-the-user-and-todo-models",id:"tutorials/multi-user-todo-list/2-the-user-and-todo-models",isDocsHomePage:!1,title:"Les Mod\xe8les User & Todo",description:"Tout d'abord, si vous avez t\xe9l\xe9charg\xe9 le code source du pr\xe9c\xe9dent tutoriel, compilez et ex\xe9cutez les migrations existantes.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/2-the-user-and-todo-models.md",slug:"/tutorials/multi-user-todo-list/2-the-user-and-todo-models",permalink:"/fr/docs/tutorials/multi-user-todo-list/2-the-user-and-todo-models",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/fr/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/2-the-user-and-todo-models.md",version:"current",sidebar:"someSidebar",previous:{title:"Introduction",permalink:"/fr/docs/tutorials/multi-user-todo-list/1-Introduction"},next:{title:"Les Scripts Shell",permalink:"/fr/docs/tutorials/multi-user-todo-list/3-the-shell-scripts"}},l=[{value:"Le Mod\xe8le User",id:"le-mod\xe8le-user",children:[]},{value:"Le Mod\xe8le Todo",id:"le-mod\xe8le-todo",children:[]},{value:"Les Migrations",id:"les-migrations",children:[]}],u={toc:l};function c(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Tout d'abord, si vous avez t\xe9l\xe9charg\xe9 le code source du pr\xe9c\xe9dent tutoriel, compilez et ex\xe9cutez les migrations existantes."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm run build\nnpm run migrations\n")),Object(a.b)("h2",{id:"le-mod\xe8le-user"},"Le Mod\xe8le User"),Object(a.b)("p",null,"Ensuite, ouvrez le fichier ",Object(a.b)("inlineCode",{parentName:"p"},"user.entity.ts")," dans le r\xe9pertoire ",Object(a.b)("inlineCode",{parentName:"p"},"src/app/entities"),". L'entit\xe9 ",Object(a.b)("inlineCode",{parentName:"p"},"User")," est la classe principale utilis\xe9e par le syst\xe8me d'authentification du cadre."),Object(a.b)("p",null,"Ajoutez les propri\xe9t\xe9s ",Object(a.b)("inlineCode",{parentName:"p"},"email")," et ",Object(a.b)("inlineCode",{parentName:"p"},"password")," et la m\xe9thode ",Object(a.b)("inlineCode",{parentName:"p"},"setPassword"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"import { hashPassword } from '@foal/core';\nimport { BaseEntity, Column, Entity, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class User extends BaseEntity {\n\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({ unique: true })\n  email: string;\n\n  @Column()\n  password: string;\n\n  async setPassword(password: string) {\n    this.password = await hashPassword(password);\n  }\n\n}\n\n// This line is required. It will be used to create the SQL session table.\nexport { DatabaseSession } from '@foal/typeorm';\n")),Object(a.b)("p",null,"La m\xe9thode ",Object(a.b)("inlineCode",{parentName:"p"},"setPassword")," utilise la fonction ",Object(a.b)("inlineCode",{parentName:"p"},"hashPassword")," pour hacher les mots de passe avant de les stocker dans la base de donn\xe9es. Vous devez utiliser cette m\xe9thode pour d\xe9finir un mot de passe au lieu d'attribuer directement une valeur \xe0 l'attribut ",Object(a.b)("inlineCode",{parentName:"p"},"password"),"."),Object(a.b)("h2",{id:"le-mod\xe8le-todo"},"Le Mod\xe8le Todo"),Object(a.b)("p",null,"Le mod\xe8le Todo d\xe9fini dans le pr\xe9c\xe9dent tutoriel a maintenant besoin d'une propri\xe9t\xe9 ",Object(a.b)("inlineCode",{parentName:"p"},"owner")," pour savoir \xe0 quel utilisateur il appartient."),Object(a.b)("p",null,"Remplacez le contenu de ",Object(a.b)("inlineCode",{parentName:"p"},"todo.entity.ts")),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"import { BaseEntity, Column, Entity, ManyToOne, PrimaryGeneratedColumn } from 'typeorm';\nimport { User } from './user.entity';\n\n@Entity()\nexport class Todo extends BaseEntity {\n\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  text: string;\n\n  @ManyToOne(type => User)\n  owner: User;\n\n}\n\n")),Object(a.b)("p",null,'Dans la base de donn\xe9es, la table "todo" ressemblera \xe0 ceci :'),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"+------------+-----------+-------------------------------------+\n|                             todo                             |\n+------------+-----------+-------------------------------------+\n| id         | integer   | PRIMARY KEY AUTO_INCREMENT NOT NULL |\n| text       | varchar   | NOT NULL                            |\n| ownerId    | integer   |                                     |\n+------------+-----------+-------------------------------------+\n")),Object(a.b)("h2",{id:"les-migrations"},"Les Migrations"),Object(a.b)("p",null,"La derni\xe8re \xe9tape consiste \xe0 cr\xe9er/mettre \xe0 jour les tables dans la base de donn\xe9es. Comme dans le premier tutoriel, vous utiliserez les migrations pour cela."),Object(a.b)("p",null,"G\xe9n\xe9rez les migrations \xe0 partir des entit\xe9s."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm run makemigrations\n")),Object(a.b)("p",null,"Un nouveau fichier est ajout\xe9 dans ",Object(a.b)("inlineCode",{parentName:"p"},"src/migrations"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),'import {MigrationInterface, QueryRunner} from "typeorm";\n\nexport class migration1562765487944 implements MigrationInterface {\n\n    public async up(queryRunner: QueryRunner): Promise<void> {\n        // SQL queries...\n    }\n\n    public async down(queryRunner: QueryRunner): Promise<void> {\n        // SQL queries...\n    }\n\n}\n')),Object(a.b)("p",null,"Ensuite, ex\xe9cutez le nouveau fichier de migration."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"npm run migrations\n")))}c.isMDXComponent=!0},259:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=o.a.createContext({}),c=function(e){var t=o.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return o.a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,b=d["".concat(i,".").concat(m)]||d[m]||p[m]||a;return n?o.a.createElement(b,s(s({ref:t},u),{},{components:n})):o.a.createElement(b,s({ref:t},u))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);