(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{140:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return u})),n.d(t,"default",(function(){return l}));var o=n(3),r=n(7),a=(n(0),n(259)),s={title:"Todos & Possession"},i={unversionedId:"tutorials/multi-user-todo-list/6-todos-and-ownership",id:"tutorials/multi-user-todo-list/6-todos-and-ownership",isDocsHomePage:!1,title:"Todos & Possession",description:"Actuellement, l'API renvoie les todos de chacun \xe0 chaque utilisateur. Ce n'est pas le comportement attendu. Nous aimerions que chaque utilisateur n'ait acc\xe8s qu'\xe0 ses t\xe2ches.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/6-todos-and-ownership.md",slug:"/tutorials/multi-user-todo-list/6-todos-and-ownership",permalink:"/fr/docs/tutorials/multi-user-todo-list/6-todos-and-ownership",editUrl:"https://github.com/FoalTS/foal/edit/master/docs/i18n/fr/docusaurus-plugin-content-docs/current/tutorials/multi-user-todo-list/6-todos-and-ownership.md",version:"current",sidebar:"someSidebar",previous:{title:"Contr\xf4leurs & Hooks d'Authentification",permalink:"/fr/docs/tutorials/multi-user-todo-list/5-auth-controllers-and-hooks"},next:{title:"La Page d'Inscription",permalink:"/fr/docs/tutorials/multi-user-todo-list/7-the-signup-page"}},u=[],c={toc:u};function l(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Actuellement, l'API renvoie les todos de chacun \xe0 chaque utilisateur. Ce n'est pas le comportement attendu. Nous aimerions que chaque utilisateur n'ait acc\xe8s qu'\xe0 ses t\xe2ches."),Object(a.b)("p",null,"Retournez \xe0 l'",Object(a.b)("inlineCode",{parentName:"p"},"ApiController")," et mettez \xe0 jour la route ",Object(a.b)("inlineCode",{parentName:"p"},"getTodos"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"  @Get('/todos')\n  async getTodos(ctx: Context) {\n    const todos = await Todo.find({ owner: ctx.user });\n    return new HttpResponseOK(todos);\n  }\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"L'objet ",Object(a.b)("inlineCode",{parentName:"p"},"Context")," contient quatre propri\xe9t\xe9s :"),Object(a.b)("ul",{parentName:"blockquote"},Object(a.b)("li",{parentName:"ul"},"l'objet ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"https://expressjs.com/en/4x/api.html#req"}),"requ\xeate d'Express"),","),Object(a.b)("li",{parentName:"ul"},"un objet vide appel\xe9 ",Object(a.b)("inlineCode",{parentName:"li"},"state")," qui peut \xeatre utilis\xe9 pour partager des donn\xe9es entre les hooks, "),Object(a.b)("li",{parentName:"ul"},"un objet ",Object(a.b)("inlineCode",{parentName:"li"},"session"),","),Object(a.b)("li",{parentName:"ul"},"et l'objet ",Object(a.b)("inlineCode",{parentName:"li"},"user")," qui est d\xe9fini si un utilisateur se connecte."))),Object(a.b)("p",null,"Rafra\xeechissez la page todo-list. Vous ne devriez voir que les todos de l'utilisateur avec lequel vous vous \xeates connect\xe9."),Object(a.b)("p",null,"Cependant, si vous essayez de cr\xe9er une nouvelle t\xe2che, elle dispara\xeetra lors du rafra\xeechissement de la page. Ceci est parfaitement normal puisque nous ne sp\xe9cifions pas son propri\xe9taire lors de la cr\xe9ation."),Object(a.b)("p",null,"Quant \xe0 la fonction de suppression, vous devez \xe9galement en restreindre l'acc\xe8s. Les utilisateurs ne devraient pouvoir supprimer que leurs t\xe2ches."),Object(a.b)("p",null,"Mettez \xe0 jour le contr\xf4leur de l'API."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"  @Post('/todos')\n  @ValidateBody({\n    additionalProperties: false,\n    properties: {\n      text: { type: 'string' }\n    },\n    required: [ 'text' ],\n    type: 'object',\n  })\n  async postTodo(ctx: Context) {\n    const todo = new Todo();\n    todo.text = ctx.request.body.text;\n    // Make the current user the owner of the todo.\n    todo.owner = ctx.user;\n\n    await todo.save();\n\n    return new HttpResponseCreated(todo);\n  }\n\n  @Delete('/todos/:id')\n  @ValidatePathParam('id', { type: 'number' })\n  async deleteTodo(ctx: Context) {\n    const todo = await Todo.findOne({\n      id: ctx.request.params.id,\n      // Do not return the todo if it does not belong to the current user.\n      owner: ctx.user\n    });\n    if (!todo) {\n      return new HttpResponseNotFound();\n    }\n    await todo.remove();\n    return new HttpResponseNoContent();\n  }\n")),Object(a.b)("p",null,"L'application fonctionne maintenant correctement."))}l.isMDXComponent=!0},259:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),l=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),p=l(n),b=o,m=p["".concat(s,".").concat(b)]||p[b]||d[b]||a;return n?r.a.createElement(m,i(i({ref:t},c),{},{components:n})):r.a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=b;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=n[c];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);